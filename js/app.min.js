function mapErrorhandling(){$("body").html("We are unable Google Maps. Please refresh your browser and try again.")}function initMap(){var e=[{featureType:"administrative",elementType:"all",stylers:[{saturation:"-100"}]},{featureType:"administrative.province",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-100},{lightness:"50"},{visibility:"simplified"}]},{featureType:"road",elementType:"all",stylers:[{saturation:"-100"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"all",stylers:[{lightness:"30"}]},{featureType:"road.local",elementType:"all",stylers:[{lightness:"40"}]},{featureType:"transit",elementType:"all",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]},{featureType:"water",elementType:"labels",stylers:[{lightness:-25},{saturation:-100}]}],o={lat:45.496814,lng:-73.58248};new google.maps.LatLngBounds;map=new google.maps.Map(document.getElementById("map"),{center:o,zoom:15,mapTypeControl:!1,styles:e}),ko.applyBindings(new mapViewModel)}$(document).ready(function(){var e=!1,o=$(window).width();(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))||900>=o)&&(e=!0,e===!0&&$("head").append('<link rel="stylesheet" href="css/mobile.css"/>'))});var venueMarkers=function(e){this.name=ko.observable(e.venue.name),this.location=ko.observable(e.venue.location),this.position=ko.computed(function(){var e=this.location().lat,o=this.location().lng;return new google.maps.LatLng(e,o)},this),this.category=ko.observable(e.venue.categories[0].name),this.address=ko.observable(e.venue.location.formattedAddress),this.phone=ko.observable(e.venue.contact.formattedPhone),this.rating=ko.observable(e.venue.rating),this.url=ko.observable(e.venue.url),this.imgSrc=ko.observable("https://irs0.4sqi.net/img/general/800x600"+e.venue.photos.groups[0].items[0].suffix)},map,mapViewModel=function(){function e(){var e=document.getElementById("search-area"),o=new google.maps.places.Autocomplete(e);o.bindTo("bounds",map),o.addListener("place_changed",function(){var e=o.getPlace();e.geometry?(t(e),n(e)):(window.alert("No details available for input:"+e.name),m.message("Re-set your location"))})}function o(e){var o={query:e};service=new google.maps.places.PlacesService(map),service.textSearch(o,a)}function a(e,o){o==google.maps.places.PlacesServiceStatus.OK?(t(e[0]),n(e[0])):(m.neighborhoodErrorMessage("Fail to load the default Neighborhood, please refresh"),console.log("Failed to load the defaultNeighborhood"))}function t(e){var o={url:"img/neighborhood.png",size:new google.maps.Size(48,48),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,48)},a=new google.maps.Marker({map:map,id:e.place_id,position:e.geometry.location,animation:google.maps.Animation.DROP,title:e.name,icon:o});u.push(a);var t="<div>"+a.title+"</div>";google.maps.event.addListener(a,"click",function(){h.setContent(t),h.open(map,this)})}function n(e){var o=e.geometry.location.lat(),a=e.geometry.location.lng(),t=o+","+a;g="https://api.foursquare.com/v2/venues/explore?ll="+t,extra="&section=coffee&limit=15&sortByDistance=1&time=any&venuePhotos=1&oauth_token=11R24OTEDHVMGTG41PCGFSDICHFA3XKUTJSBQVSFNKYUGR12&v=20161220";var n=g+extra;$.getJSON(n,function(e){var o=e.response.groups[0].items,a=e.response.suggestedBounds;o.forEach(function(e){m.nearByPlaces.push(new venueMarkers(e))}),m.filteredList(m.nearByPlaces());for(var t=0,n=m.nearByPlaces().length;n>t;t++)i(m.nearByPlaces()[t]);void 0!==a&&(mapBounds=new google.maps.LatLngBounds(new google.maps.LatLng(a.sw.lat,a.sw.lng),new google.maps.LatLng(a.ne.lat,a.ne.lng)),map.fitBounds(mapBounds))}).fail(function(e){m.fourSquareErrorMessage("Failed to load foursquare json,please refresh"),console.log("Failed to load foursquare json")})}function i(e){var o=e.name(),a=e.category(),t=e.position(),n=e.address(),i=e.phone(),r=e.imgSrc(),l=e.rating(),p=e.url(),g={url:"img/coffee.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,32)},m=new google.maps.Marker({map:map,position:t,animation:google.maps.Animation.DROP,title:o,icon:g});c.push(m),void 0===i&&(i="Not Available Phone"),void 0===p&&(p="Not Available Website");var d='<div class="venueInfo"><p class = venueName><img class = foursquareLogo src = "img/foursquare.png" alt = "logo" >'+o+' <em class = "rating">'+l+'</em></p><p class="venueCategory">'+a+'</p><p class="venueAddress">'+n+"</p>",u="<p class = venuePhone>"+i+"</p><p class = venueURL><a href = "+p+' target="_blank">'+p+"</a></p><div class = snapshot><img src = "+r+"></div></div>",v=d+u;google.maps.event.addListener(m,"click",function(){s(m),h.setContent(v),map.setCenter(m.position),map.panBy(0,-250),h.open(map,this)}),google.maps.event.addListener(h,"closeclick",function(){var e=map.getCenter();map.setCenter(e)})}function s(e){null!==e.getAnimation()?e.setAnimation(null):(map.setCenter(e.position),e.setAnimation(google.maps.Animation.BOUNCE),r(e))}function r(e){setTimeout(function(){e.setAnimation(null)},2100)}function l(){for(var e=0,o=u.length;o>e;e++)u[e].setMap(null),u[e]=null;for(;u.length>0;)u.pop()}function p(){for(var e=0,o=c.length;o>e;e++)c[e].setMap(null),c[e]=null;for(;c.length>0;)c.pop(),m.nearByPlaces().pop()}var g,m=this,c=[],d="3455 Chemin de la Côte-des-Neiges, Montréal, QC H3H, Canada",u=[];if(m.neighborhood=ko.observable(""),m.neighborhoodErrorMessage=ko.observable(""),m.fourSquareErrorMessage=ko.observable(""),m.message=ko.observable("Set new neighborhood location"),m.fliteredMessage=ko.observable("Fliter by the name"),m.keyword=ko.observable(""),m.nearByPlaces=ko.observableArray([]),m.toggleSymbol=ko.observable("show list"),m.filteredList=ko.observableArray([]),"undefined"!=typeof google)var h=new google.maps.InfoWindow({maxWidth:300,pixelOffset:new google.maps.Size(0,0)});this.listToggle=function(){"hide list"===m.toggleSymbol()?m.toggleSymbol("show list"):m.toggleSymbol("hide list")},m.neighborhoodChange=ko.computed(function(){""!==m.neighborhood()&&(l(),p(),m.neighborhood(""))}),google.maps.event.addDomListener(window,"resize",function(){var e=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(e)}),window.addEventListener("resize",function(e){$("#map").height($(window).height()),$("#map").width($(window).width())}),o(d),e(),m.focusMarker=function(e){for(var o=e.name(),a=0;a<c.length;a++)c[a].title===o&&google.maps.event.trigger(c[a],"click")},m.filterKeyword=function(){var e=m.keyword().toLowerCase(),o=!1;if(!e)return void window.alert("No place is founded, please validate your input");m.filteredList([]);for(var a=0,t=m.nearByPlaces().length;t>a;a++)-1!==m.nearByPlaces()[a].name().toLowerCase().indexOf(e)?(m.filteredList.push(m.nearByPlaces()[a]),c[a].setMap(map),s(c[a]),o=!0):(-1===m.nearByPlaces()[a].name().toLowerCase().indexOf(e)&&(c[a].setMap(null),m.keyword(""),m.fliteredMessage("Re-enter the validated name")),o&&m.fliteredMessage("Fliter by the name"))},m.clearFilter=function(){m.filteredList(m.nearByPlaces()),m.fliteredMessage("Fliter by the name"),place;for(var e=0,o=c.length;o>e;e++)c[e].setMap(map)}};